<div><script wis-load=url>wis.app.register.controller("UrlCtrl",["$http","$q","$scope","$timeout","parseUri",function(t,e,n,i,o){function r(t){var e=t.headers(),n=e["content-disposition"],i=o(d.text);d.info={type:/[^\;]*/.exec(e["content-type"])[0],name:n&&n.match(/filename="([^"\\]*(?:\\.[^"\\]*)*)"/i)[1]||i.path.replace(/\/$/,"").split("/").pop()||i.host,size:!e["content-encoding"]&&~~e["content-length"]||null,lastModifiedDate:new Date(e["last-modified"]||e.date),head:e},f[d.text]=d.info,d.loadingInfo=0}function a(){return t.head("/u/proxy",{timeout:l.promise,params:{url:d.text}}).then(r,function(){d.loadingInfo=0,d.info={404:"not found"}})}var s,f=(wis.el("a"),{}),l=e.defer(),d=this;d.text="",d.submit=function(t,e){d.text&&(d.info=e.add("link-url","url",d.text,d.info.lastModifiedDate,d.info.name,d.info.size,d.info.type,"",d.info.head||{}),i.cancel(s),d.loadingInfo=0,d.text="",t.$setPristine())},n.$on("$destroy",function(){l.resolve()}),d.focus=function(){wis.query("#inputUrl")[0].focus()},d.change=function(){d.loadingInfo=0,d.info=f[d.text],l.resolve(),i.cancel(s),l=e.defer(),d.text&&!d.info&&(d.loadingInfo=1,s=i(a,250))}}]),wis.app.register.directive({wisUrl:function(){return{restrict:"A",require:"?ngModel",link:function(t,e,n,i){function o(t){return void 0!=t&&0!="http://".indexOf(t.substring(0,7))&&0!="https://".indexOf(t.substring(0,8))?(i.$setViewValue("http://"+t),i.$render(),i.$setValidity("native",!0),i.$viewValue):t}var r=e[0];i.$formatters=[o],i.$parsers=[o],r.validity&&(i.$validators.native=function(){return r.validity.valid})}}}});</script><form ng-controller="UrlCtrl as Url" ng-submit="Url.submit(myForm, FileList)" name=myForm class=form-horizontal><style scoped ng-if=::Main.supports.cssAnimation>.glyphicon-refresh{position:absolute;right:25px;top:10px;-webkit-animation:anim-rotate8 1s linear infinite;animation:anim-rotate8 1s linear infinite}@-webkit-keyframes anim-rotate8{from{-webkit-transform:rotate(0)}to{-webkit-transform:rotate(360deg)}}@keyframes anim-rotate8{from{-webkit-transform:rotate(0)}to{-webkit-transform:rotate(360deg)}}</style><div class=form-group><label for=inputUrl class="col-sm-2 control-label"></label><div class=col-sm-8><p class=lead>{{$locale.SERVICES.selectFromWeb}}</p></div></div><div class=form-group><label for=inputUrl class="col-sm-2 control-label">Url</label><div class=col-sm-8><input autofocus class=form-control id=inputUrl ng-change=Url.change() ng-model=Url.text placeholder="e.g. http://example.com/someImage.jpg" required type=url wis-allow-default wis-url>   <span ng-if=Url.loadingInfo class="glyphicon glyphicon-refresh"></span></div></div><div class=form-group><div class="col-sm-offset-2 col-sm-10"><button ng-disabled=!Url.text ng-click=Url.focus() type=submit class="btn btn-primary">{{::$locale.BUTTON.add}}</button></div></div></form></div>