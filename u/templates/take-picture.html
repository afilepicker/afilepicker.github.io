<script wis-load=my-photo>wis.app.register.controller("PhotoCtrl",["file","$filter","$scope",function(e,o,t){function i(e){if(r=e,"mozSrcObject"in d)d.mozSrcObject=e;else{var o=wis.vendor(window,"URL");d.src=o?o.createObjectURL(e):e}d.play(),a.promoting=!1,t.$apply()}function n(e){console.log(e),console.log("An error occured! ")}var a=this,r=!1,c=wis.query("video"),d=c[0],s=wis.el("canvas"),l=s.getContext("2d");a.promoting=!0,a.add=function(){},MediaStreamTrack.getSources(function(e){console.log(e),a.sourceInfos=o("filter")(e,{kind:"video"}),t.$apply()}),a.sourceId=0,a.changedSourceId=function(){var e={video:{optional:[{sourceId:a.sourceId}]},audio:!1};d.pause(),r&&r.stop(),wis.vendor(navigator,"getUserMedia",e,i,n)},a.capture=function(){l.drawImage(d,0,0,s.width,s.height);var t="DataUrl",i=s.toDataURL(),n=new Date,a="Bild "+o("date")(n,"yyyy-MM-dd kl. HH.mm.ss")+".png",r=Math.round(3*i.split(",")[1].replace(/=/g,"").length/4),c="image/png",u="";e.add(t,i,n,a,r,c,u)},localStorage.clear(),c.on("canplay",function(){r&&(s.width=d.videoWidth,s.height=d.videoHeight,l.translate(s.width,0),l.scale(-1,1))}),t.$on("$destroy",function(){d.pause(),r&&r.stop()})}]);</script><div ng-controller="PhotoCtrl as Photo"><div ng-if=!Main.supports.captureInput class="alert alert-info"><a href=other-device>Use your Smartphone to take a photo</a> <button type=button class=close wis-dismiss=rec>&times;</button></div><select ng-change=Photo.changedSourceId() ng-model=Photo.sourceId ng-options="sourceInfo.id as sourceInfo.label || 'Camera' for sourceInfo in Photo.sourceInfos"></select><br><div ng-if=Main.supports.captureInput class="alert alert-info"><label for=own>Use your own application to take a sound</label><button type=button class=close wis-dismiss=useNativeCamera>&times;</button> <input id=own class=ng-hide type=file ng-model=Photo.files ng-change=Photo.add() name=photo accept=image/* capture></div><span ng-hide=Photo.promoting id=takePitcture><video autoplay></video><button class=ui-up ng-click=Photo.capture() id=shutter></button></span></div>