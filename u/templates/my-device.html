<script wis-load=my-device>wis.app.register.directive({wisFile:["$rootScope","$parse","$q",function(e,t,i){function n(e){e.stopPropagation(),e.preventDefault()}var r=i.when(),a=function(e){return r=r.then(function(){return i(function(t,i){e.createReader().readEntries(t,i)})})};return{restrict:"A",link:function(i,r,o){function l(e,t){c.add("my-device","blob",e,e.lastModifiedDate,e.name,e.size,e.type,t)}var c;i.$watch(o.wisMultiple,function(e){o.$set("multiple",!!(e-1))}),r.on("dragover dragenter",n),r.on("drop change",function(n){function r(e){angular.forEach(e,function(e){e.isFile&&e.file(function(t){l(t,e.fullPath),i.$apply()},function(){}),e.isDirectory&&(c.add("my-device","directory",void 0,new Date,".",0,"inode/directory",e.fullPath+"/."),a(e).then(r))})}c=e.FileList,n.preventDefault();var o=n.dataTransfer;if(t("items[0].webkitGetAsEntry")(o)){for(var f=o.files,s=f.length,u=[],d=0;s>d;d++){var p=o.items[d].webkitGetAsEntry();p.isFile?l(f[d],"/"+f[d].name):p.isDirectory?u.push(p):0}return r(u),void i.$apply()}for(var f=(o||n.target).files,d=f.length;d--;)l(f[d],"/"+(f[d].webkitRelativePath||""));i.$apply()})}}}]});</script><div ng-switch on=FileList.saveMode><div ng-switch-when=true><div ng-init="html5 = Main.supports.fileReader && Main.supports.file && Main.supports.filelist"><div class="well dnd" id=holder wis-file><p ng-repeat="file in FileList.files track by file.id">{{::file.relativePath}}</p></div><p class=text-center><span class=file-wrapper><label for=chooseFile class="btn btn-primary" ng-click=FileList.saveAll() count=FileList.files.length when=$locale.SERVICES.download ng-pluralize></label></span></p></div></div><div ng-switch-default><div ng-init="html5 = Main.supports.fileReader && Main.supports.file && Main.supports.filelist"><div ng-if=::Main.supports.dragNdrop class="well dnd" id=holder wis-file ng-switch="FileList.directory && Main.supports.dragNdropFolder"><h2 ng-if="::(FileList.directory && Main.supports.dragNdropFolder)" id=localDragHelp class=center ng-bind=::$locale.dropFilesOrFolderHere></h2><h2 ng-if="::(!FileList.directory || !Main.supports.dragNdropFolder)" id=localDragHelp class=center count=FileList.leftToChoose when=::$locale.dropFilesHere ng-pluralize></h2></div><p class=text-center><span class=file-wrapper ng-if=1 ng-init="class={}"><b ng-include="::(!html5 && Main.supports.flash && '/u/templates/flashFallback.html')"></b> <input wis-allow-default type=file wis-file id=chooseFile autofocus wis-multiple=FileList.leftToChoose ng-if=::html5><label for=chooseFile class="btn btn-primary" count=FileList.leftToChoose when=$locale.BUTTON.browseFile ng-pluralize></label></span> <span class=file-wrapper ng-if="::(FileList.directory && Main.supports.directory)"><input wis-allow-default type=file wis-file id=chooseFolder webkitdirectory><label class="btn btn-primary" for=chooseFolder ng-class=class ng-bind=::$locale.BUTTON.browseFolder></label></span></p></div></div></div>
