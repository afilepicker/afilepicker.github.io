<script wis-load=record-sound>wis.app.register.controller("RecordSoundCtrl",["$scope","$interval","file","$filter",function(t,n,e,r){function a(){alert("Error capturing audio.")}function o(t,n){for(var e=2*t.length,r=new Float32Array(e),a=0,o=0;e>o;)r[o++]=t[a],r[o++]=n[a],a++;return r}function i(t,n){for(var e=new Float32Array(n),r=0,a=0,o=t.length;o>r;r++,a+=F){var i=t[r];e.set(i,a)}return e}function c(t,n,e){for(var r=e.length,a=0;r>a;a++)t.setUint8(n+a,e.charCodeAt(a))}function s(t){v=t,f=wis.vendor(window,"AudioContext"),g=new f,d=g.createGain(),l=g.createMediaStreamSource(t),l.connect(d),u=g.createJavaScriptNode(F,2,2);var e=0;w=n(function(){var t=Math.round(e),n=Math.floor(t/60),r=t-60*n;h.min=10>n?"0"+n:n,h.sec=60==r?"00":10>r?"0"+r:r},1e3),u.onaudioprocess=function(t){if(h.recording){var n=t.inputBuffer;p.push(new Float32Array(n.getChannelData(0))),U.push(new Float32Array(n.getChannelData(1))),e+=n.duration}},d.connect(u),u.connect(g.destination)}var u,d,l,f,g,v,w,h=this,p=[],U=[],y=0,A=44100,m={audio:!0},F=16384;h.recording=!1,h.promoting=!1,h.min="00",h.sec="00",h.start=function(){h.promoting=!0,wis.vendor(navigator,"getUserMedia",m,s,a),h.recording=!0,y=0},h.pause=function(){v.stop(),n.cancel(w),h.recording=!1;var t=p.length*F,a=i(p,t),s=i(U,t),u=o(a,s),d=new ArrayBuffer(44+2*u.length),l=new DataView(d);c(l,0,"RIFF"),l.setUint32(4,44+2*u.length,!0),c(l,8,"WAVE"),c(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,2,!0),l.setUint32(24,A,!0),l.setUint32(28,4*A,!0),l.setUint16(32,4,!0),l.setUint16(34,16,!0),c(l,36,"data"),l.setUint32(40,2*u.length,!0);for(var f=u.length,g=44,y=1,m=0;f>m;m++)l.setInt16(g,32767*u[m]*y,!0),g+=2;var M=new Blob([l],{type:"audio/wav"}),C=new Date,D="Audio "+r("date")(C,"yyyy-MM-dd kl. HH.mm.ss")+".wav";e.add("blob",M,C,D,M.size,"audio/wav","")}}]);</script><div ng-controller="RecordSoundCtrl as Rec"><style scoped>#clock{text-align:center;padding:30px;font:40px digital-7_monomono;line-height:0;margin:0 auto;width:150px;border:dashed #000 1px}</style><div ng-if=!Main.supports.captureInput class="alert alert-info"><a ng-click="Main.tpl = 'other-device.html'">Use your Smartphone to record a sound</a> <button type=button class=close wis-dismiss=rec>&times;</button></div><div ng-if=Main.supports.captureInput class="alert alert-info"><label for=own>Use your own application to record a sound</label><button type=button class=close>&times;</button> <input id=own class=ng-hide type=file name=photo accept=audio/* capture></div><div id=clock class=well>{{Rec.min}}:{{Rec.sec}}</div><button autofocus ng-click="Rec.recording ? Rec.pause() : Rec.start()">{{Rec.recording ? 'Pause' : 'Start'}}</button> <button ng-if="!Rec.recording && !Rec.buffer" ng-click=Rec.save()>save</button></div>